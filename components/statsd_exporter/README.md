# statsd_exporter
`statsd_exporter` is used to receive the metrics (in `statsd` format) from [`Envoy`](https://www.envoyproxy.io/docs/envoy/latest/operations/admin), 
and transform the metrics into [`Prometheus`](https://prometheus.io) format.

We will build a docker image for `stats_exporter` with [some customerization](https://github.com/songbinliu/statsd_exporter/tree/k8s):
* Providing a debug mode: log the number of metrics;
* Setting the default mapping for timer metrics to `Prometheus` histogram.

# Run the docker image

Run in debug mode:
```bash
docker run -d -p 8125:9125/udp -p 9102:9102 beekman9527/statsd_exporter --debug=true --interval=10
```
`interval=10` means that it will print the counter every 10 metrics.

Run in non-debug mode:
```bash
docker run -d -p 8125:9125/udp -p 9102:9102 beekman9527/statsd_exporter
```

# Access the metrics
The metrics can be accessed through `http://hostIP:9102/metrics`, the endpoint which `Prometheus` can scrape to collect metrics.

Here are some snipts of the metrics:

```terminal
...
envoy_cluster_cpu_mem_service_upstream_rq_time{quantile="0.5"} 103
envoy_cluster_cpu_mem_service_upstream_rq_time{quantile="0.9"} 107
envoy_cluster_cpu_mem_service_upstream_rq_time{quantile="0.99"} 109
envoy_cluster_cpu_mem_service_upstream_rq_time_sum 240588
envoy_cluster_cpu_mem_service_upstream_rq_time_count 2323
# HELP envoy_cluster_cpu_mem_service_upstream_rq_total Metric autogenerated by statsd_exporter.
# TYPE envoy_cluster_cpu_mem_service_upstream_rq_total counter
envoy_cluster_cpu_mem_service_upstream_rq_total 2325
# TYPE envoy_http_ingress_http_downstream_cx_length_ms summary
envoy_http_ingress_http_downstream_cx_length_ms{quantile="0.5"} 105
envoy_http_ingress_http_downstream_cx_length_ms{quantile="0.9"} 109
envoy_http_ingress_http_downstream_cx_length_ms{quantile="0.99"} 112
envoy_http_ingress_http_downstream_cx_length_ms_sum 306339
envoy_http_ingress_http_downstream_cx_length_ms_count 2323
# HELP envoy_http_ingress_http_downstream_cx_rx_bytes_buffered Metric autogenerated by statsd_exporter.
# TYPE envoy_http_ingress_http_downstream_cx_rx_bytes_buffered gauge
envoy_http_ingress_http_downstream_cx_rx_bytes_buffered 0
# HELP envoy_http_ingress_http_downstream_cx_rx_bytes_total Metric autogenerated by statsd_exporter.
# TYPE envoy_http_ingress_http_downstream_cx_rx_bytes_total counter
envoy_http_ingress_http_downstream_cx_rx_bytes_total 235223
# HELP envoy_http_ingress_http_downstream_cx_total Metric autogenerated by statsd_exporter.
# TYPE envoy_http_ingress_http_downstream_cx_total counter
envoy_http_ingress_http_downstream_cx_total 2325
...
```
